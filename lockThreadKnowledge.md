<h3>스레드와 락</h3>

<h4>프로세스 vs 쓰레드</h4>

* 프로세스 : 실행되고 있는 프로그램의 인스턴스. CPU 시간, 메모리 등의 시스템 자원이 할당되는 독립적 개체. 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근이 불가능하다(파이프, 파일, 소켓과 같은 프로세스간 통신을 사용하면 가능)
* 스레드 : 프로세스 안에 존재하며 프로세스의 자원을 공유한다. 프로세스 안의 여러 스레드들은 각각 별도의 레지스터 및 스택을 가조기 있지만 힙 공간은 서로 공유한다.

<br><br>

<h4>Context switch</h4>

Context switch는 멀티태스킹을 지원할 때 발생하며, 두 프로세스를 전환하는 것을 의미한다(즉 대기중인 프로세스를 실행 시키고 실행 중인 프로세스를 대기 또는 종료 상태로 전환) 시간 기록을 위해선 종료 혹은 대기 되는 프로세스의 마지막 명령 시점과 실행되는 프로세스의 첫 번째 명령 시점에 타임스탬프를 기록해야 한다.
단, 사용자가 Context switch가 되는 프로세스를 컨트롤 할 수 없고 또 Context switch 사이에 어떤 상황이 발생할지 알 수 없다는 문제점이 있다. 이 문제를 해결하기 위해 대상 두 프로세스가 서로 파이프와 같은 방식을 이용해 통신하도록 하면 된다. 이렇게 하면 아래와 같은 단계로 프로세스가 처리된다.
1. P2는 P1의 파이프 데이터를 기다리며 블록
2. P1이 시작 시간 기록
3. P1이 P2에게 파이프 데이터 전송
4. P1은 P2가 보내는 데이터를 읽으려 한든 순간 Context switch가 발생
5. P2는 데이터 수신 후 응답 데이터를 P1에게 보낸다.
6. 다시 Context switch가 발생하여 P1이 데이터를 받는다.
7. P1이 종료 시간을 기록한다.

<br><br>

<h4>교착상태 없는 클래스 설계</h4>
교착상태를 방지하기 위한 한 가지 방법은 각 프로세스가 어떤 락이 필요한지 사전에 선언하여 락이 발생할 수 있다면 락을 허락하지 않는 것이다. 예를 들어 P1이 2를 사용하고 3을 기다리고, P2가 3을 사용하고 5를 기다리고, P3가 5를 사용하고 2를 기다리면 싸이클이 발생하여 교착상태에 빠지게 된다. 때문에 선언한 락을 그래프 자료구조로 표현하여 싸이클이 발생하는지 확인하면 교착상태에 빠질지 확인할 수 있다. 간단한 의사코드는 다음과 같다.

<br><br>

<h4>순서대로 호출하기</h4>
하나의 객체 인스턴스 Foo가 있고 first, second, third 메소드가 있다고 가정하자. 이 인스턴스 하나를 스레드 3개에게 전달 해주고 각각 first, second, third 메소드를 호출하게 한다고 하자. 단, second는 first가 호출되기 전, third는 second가 호출되기 전엔 호출할 수 없다고 할 때 어떻게 클래스를 설계해야 할까? 이와 같이 스레드들 간 공유된 인스턴스의 메소드 호출 순서를 컨트롤 할 땐 Java의 ReentrantLock 또는 Semaphore를 사용할 수 있다.

```
class Foo {
   public Semaphore s1, s2;
   ...
   
   first() {
      ...
      s1.release();
   }
   
   second() {
      s1.acquire();
      s1.release();
      ...
      s2.release();
   }
   
   third() {
      s2.acquire();
      s2.release();
      ...
   }
}
```

<br><br>

<h4>동기화된 메소드</h4>
동기화된 메서드 A, 일반 메서드 B가 구현된 클래스가 있다. 두 개 스레드가 이 클래스 인스턴스를 공유할 때, A와 B는 동시에 호출이 될 수 있을까?? 만약 스레드1,2 모두 메서드 A를 호출하려고 한다면 후에 호출하려 시도한 스레드는 락이 걸리게 된다. 반면 B를 동시에 호출하거나 A, B를 각각 호출하려 할 땐 동시 호출이 가능하다.

<br><br>

<h4></h4>

<br><br>

<h4></h4>

<br><br>

<h4></h4>

<br><br>

<h4></h4>

<br><br>

<h4></h4>

<br><br>



